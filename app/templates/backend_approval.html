<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Tell the browser to be responsive to screen width -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- Favicon icon -->
    <link rel="icon" type="image/png" sizes="16x16" href="/static/assets/images/state_grid.png">
    <title>{{ title }}</title>
    <!-- Bootstrap Core CSS -->
    <link href="/static/assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- chartist CSS -->
    <link href="/static/css/googlefonts.css">
    <link href="/static/assets/plugins/footable/css/footable.core.css" rel="stylesheet">
    <link href="/static/assets/plugins/bootstrap-select/bootstrap-select.min.css" rel="stylesheet"/>
    <link href="/static/assets/plugins/chartist-js/dist/chartist.min.css" rel="stylesheet">
    <link href="/static/assets/plugins/chartist-js/dist/chartist-init.css" rel="stylesheet">
    <link href="/static/assets/plugins/chartist-plugin-tooltip-master/dist/chartist-plugin-tooltip.css"
          rel="stylesheet">
    <!--This page css - Morris CSS -->
    <link href="/static/assets/plugins/c3-master/c3.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="/static/css/style.css" rel="stylesheet">
    <!-- You can change the theme colors from here -->
    <link href="/static/css/colors/zcolor.css" id="theme" rel="stylesheet">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>

<![endif]-->
</head>

<body class="fix-header fix-sidebar card-no-border logo-center">

<!-- alert flash -->
<div class="modal fade" id="overlay">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <p id="zcontent">内容</p>
            </div>
        </div>
    </div>
</div>
<!-- ============================================================== -->
<!-- Preloader - style you can find in spinners.css -->
<!-- ============================================================== -->
<div class="preloader">
    <svg class="circular" viewBox="25 25 50 50">
        <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10"/>
    </svg>
</div>
<!-- ============================================================== -->
<!-- Main wrapper - style you can find in pages.scss -->
<!-- ============================================================== -->
<div id="main-wrapper">
    <!-- ============================================================== -->
    <!-- Topbar header - style you can find in pages.scss -->
    <!-- ============================================================== -->


    <header class="topbar">
        <nav class="navbar top-navbar navbar-expand-md navbar-light">
            <!-- ============================================================== -->
            <!-- Logo -->
            <!-- ============================================================== -->
            <div class="navbar-header">
                <a class="navbar-brand" href="index.html">
                    <!-- Logo icon --><b>
                    <!-- Dark Logo icon -->
                    <img src="/static/assets/images/state_grid.png" alt="homepage" class="light-logo"
                         style="width: 50px"/>
                    <!-- Light Logo icon -->
                </b>
                    <!--End Logo icon -->
                    <!-- Logo text --><span>
                                    <b></b>
                    <!-- dark Logo text -->
                    <!-- Light Logo text -->
                         <img src="/static/assets/images/logo.png" class="light-logo img-responsive" alt="homepage"
                              style="width: 80%"/></span> </a>
            </div>
            <!-- ============================================================== -->
            <!-- End Logo -->
            <!-- ============================================================== -->
            <div class="navbar-collapse">
                <!-- ============================================================== -->
                <!-- toggle and nav items -->
                <!-- ============================================================== -->
                <ul class="navbar-nav mr-auto mt-md-0">
                    <!-- This is  -->
                    <li class="nav-item"><a class="nav-link nav-toggler hidden-md-up text-muted waves-effect waves-dark"
                                            href="javascript:void(0)"><i class="mdi mdi-menu"></i></a></li>
                    <!-- ============================================================== -->
                    <!-- Search -->
                    <!-- ============================================================== -->
                    <li class="nav-item hidden-sm-down search-box"><a
                            class="nav-link hidden-sm-down text-muted waves-effect waves-dark"
                            href="javascript:void(0)"><i class="ti-search"></i></a>
                        <form class="app-search">
                            <input type="text" class="form-control" placeholder="快速搜索"> <a class="srh-btn"><i
                                class="ti-close"></i></a></form>
                    </li>
                    <!-- ============================================================== -->
                </ul>
                <!-- ============================================================== -->
                <!-- User profile and search -->
                <!-- ============================================================== -->
                <ul class="navbar-nav my-lg-0">
                    <!-- ============================================================== -->
                    <!-- Comment -->
                    <!-- ============================================================== -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-muted text-muted waves-effect waves-dark" href=""
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i
                                class="mdi mdi-message"></i>
                            <div class="notify"><span class="heartbit"></span> <span class="point"></span></div>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right mailbox scale-up">
                            <ul>
                                <li>
                                    <div class="drop-title">通知</div>
                                </li>
                                <li>
                                    <div id="notices" class="message-center">
                                        <!-- Message -->
                                        <a href="#">
                                            <div class="btn btn-danger btn-circle"><i class="fa fa-link"></i></div>
                                            <div class="mail-contnet">
                                                <h6>通知样例</h6> <span class="mail-desc">新的备案申请</span> <span class="time">2019-1-13 12:30</span>
                                            </div>
                                        </a>
                                    </div>
                                </li>
                                <li>
                                    <a class="nav-link text-center" href="javascript:void(0);"> <strong>标记所有为已读</strong>
                                        <i class="fa fa-angle-right"></i> </a>
                                </li>
                            </ul>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-muted waves-effect waves-dark" href=""
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><img
                                src="/static/assets/images/state_grid.png" alt="user" class="profile-pic"/></a>
                        <div class="dropdown-menu dropdown-menu-right scale-up">
                            <ul class="dropdown-user">
                                <li>
                                    <div class="dw-user-box">
                                        <div class="u-img"><img src="/static/assets/images/state_grid.png" alt="user">
                                        </div>
                                        <div class="u-text">
                                            <h4>{{ current_user.username }}</h4>
                                            <p class="text-muted">{{ current_user.email }}</p><a href="profile.html"
                                                                                                 class="btn btn-rounded btn-danger btn-sm"
                                                                                                 style="color: white;">查看个人信息</a>
                                        </div>
                                    </div>
                                </li>
                                <li role="separator" class="divider"></li>
                                <li><a href="#"><i class="ti-layers"></i>&nbsp&nbsp已处理的备案</a></li>
                                <li><a href="#"><i class="ti-layers-alt"></i>&nbsp&nbsp未处理的备案</a></li>
                                <li role="separator" class="divider"></li>
                                <li><a href="/logout"><i class="fa fa-power-off"></i>&nbsp&nbsp退出</a></li>
                            </ul>
                        </div>
                    </li>
                    <!-- ============================================================== -->

                </ul>
            </div>
        </nav>
    </header>    <!-- ============================================================== -->
    <!-- End Topbar header -->
    <!-- ============================================================== -->
    <!-- ============================================================== -->
    <!-- Left Sidebar - style you can find in sidebar.scss  -->
    <!-- ============================================================== -->
    <aside class="left-sidebar" style="background: white">
        <!-- Sidebar scroll-->
        <div class="scroll-sidebar">
            <!-- Sidebar navigation-->
            <nav class="sidebar-nav">
                <ul id="sidebarnav">
                    <li class="nav-small-cap"></li>
                    <li>
                        <a class="has-arrow" href="/backend" aria-expanded="false"><i class="mdi mdi-gauge"></i><span
                                class="hide-menu">系统状态</span></a>
                    </li>
                    <li>
                        <a class="has-arrow " href="/backend/overview" aria-expanded="false"><i
                                class="mdi mdi-chart-bar"></i><span
                                class="hide-menu">备案概览</span></a>
                    </li>
                    <li>
                        <a class="has-arrow" href="/backend/lookup" aria-expanded="false"><i
                                class="mdi mdi-airplay"></i><span
                                class="hide-menu">查看备案</span></a>
                    </li>
                    <li>
                        <a class="has-arrow" href="/backend/approval" aria-expanded="false"><i
                                class="mdi mdi-pencil"></i><span
                                class="hide-menu">审批备案</span></a>
                    </li>
                    <li>
                        <a class="has-arrow" href="/backend/help" aria-expanded="false"><i
                                class="mdi mdi-chart-bubble"></i><span
                                class="hide-menu">帮助</span></a>
                    </li>
                </ul>
            </nav>
            <!-- End Sidebar navigation -->
        </div>
        <!-- End Sidebar scroll-->
    </aside>
    <!-- ============================================================== -->
    <!-- End Left Sidebar - style you can find in sidebar.scss  -->
    <!-- ============================================================== -->
    <!-- ============================================================== -->
    <!-- Page wrapper  -->
    <!-- ============================================================== -->
    <div class="page-wrapper">
        <!-- ============================================================== -->
        <!-- Container fluid  -->
        <!-- ============================================================== -->
        <div class="container-fluid">
            <!-- ============================================================== -->
            <!-- Bread crumb and right sidebar toggle -->
            <!-- ============================================================== -->
            <div class="row page-titles">
                <div class="col-md-5 col-8 align-self-center">
                    <h4 class="text-themecolor">{{ title }}</h4>
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="javascript:void(0)">主页</a></li>
                        <li class="breadcrumb-item active">{{ title }}</li>
                    </ol>
                </div>
                <div class="col-md-7 col-4 align-self-center">
                    <div class="d-flex m-t-10 justify-content-end">
                        <div class="d-flex m-r-20 m-l-10 hidden-md-down">
                            <div class="chart-text m-r-10">
                                <h6 class="m-b-0">
                                    <small>本月</small>
                                </h6>
                                <h4 class="m-t-0 text-info">55</h4></div>
                            <div class="spark-chart">
                                <div id="monthchart"></div>
                            </div>
                        </div>
                        <div class="d-flex m-r-20 m-l-10 hidden-md-down">
                            <div class="chart-text m-r-10">
                                <h6 class="m-b-0">
                                    <small>上月</small>
                                </h6>
                                <h4 class="m-t-0 text-primary">66</h4></div>
                            <div class="spark-chart">
                                <div id="lastmonthchart"></div>
                            </div>
                        </div>
                        <div class="">
                            <button class="right-side-toggle waves-effect waves-light btn-success btn btn-circle btn-sm pull-right m-l-10">
                                <i class="ti-settings text-white"></i></button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ============================================================== -->
            <!-- End Bread crumb and right sidebar toggle -->
            <!-- ============================================================== -->
            <!-- ============================================================== -->
            <!-- Start Page Content -->
            <!-- ============================================================== -->
            <!-- Row -->
            <div class="card">
                <div class="card-body">

                    <table id="demo-foo-addrow2" class="table table-bordered table-hover toggle-circle"
                           data-page-size="7">
                        <thead>
                        <tr>
                            <th data-sort-initial="true" data-toggle="true">备案号</th>
                            <th>备案种类</th>
                            <th data-hide="phone, tablet">生产厂家</th>
                            <th data-hide="phone, tablet">备案申请时间</th>
                            <th data-hide="phone, tablet">备案联系人</th>
                            <th data-sort-ignore="true" class="min-width">电能表型号</th>
                            <th class="text-nowrap">审批操作</th>

                        </tr>
                        </thead>

                        <tbody>
                        {% for record in records %}
                            <tr>
                                <td>
                                    <a href="/backend/records/{{ record.serial_number }}">{{ record.serial_number }}</a>
                                </td>
                                <td>{{ record.get_back_type() }}
                                    {#                                            <div class="progress progress-xs margin-vertical-10 ">#}
                                    {#                                                <div class="progress-bar bg-info"#}
                                    {#                                                     style="width: 35%; height:6px;"></div>#}
                                    {#                                            </div>#}
                                </td>
                                <td>{{ record.producer_name }}
                                    {#                                            <a href="" data-toggle="tooltip" data-original-title="点击查看完整信息">&nbsp;国网，带操作系统...</a>#}
                                </td>
                                <td>{{ record.to_strftime() }}</td>

                                <td>{{ record.contact_person }}</td>

                                <td>{{ record.dianbiao_version }}</td>
                                <td class="text-nowrap" align="center">
                                    <button id="{{ record.serial_number }}" onclick="agree(this)"
                                            type="button"
                                            class="btn btn-sm btn-icon btn-pure btn-outline delete-row-btn"
                                            data-toggle="tooltip" data-original-title="审批通过"><i
                                            class="fa fa-check text-info" aria-hidden="true"></i>
                                    </button>
                                    <button id="{{ record.serial_number }}" onclick="cancel(this)"
                                            type="button"
                                            class="btn btn-sm btn-icon btn-pure btn-outline delete-row-btn"
                                            data-toggle="tooltip" data-original-title="审批驳回">
                                        <i class="fa fa-close text-danger" aria-hidden="true"></i></button>
                                    {#                                                <a onclick="agree()" id="{{ record.serial_number }}"  data-toggle="tooltip" data-original-title="审批通过"> <i#}
                                    {#                                                        class="fa fa-check text-inverse m-r-10"></i> </a>#}
                                    {#                                                <a  onclick="cancel()" id="{{ record.serial_number }}" data-toggle="tooltip" data-original-title="审批驳回"> <i#}
                                    {#                                                        class="fa fa-close text-danger"></i> </a>#}
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                        <tfoot>
                        <tr>

                            <td colspan="12">
                                            <div class="text-right pull-right">
                                                <ul class="pagination"></ul>
                                            </div>
                                        </td>
                        </tr>
                        </tfoot>
                    </table>
                </div>
            </div>


            <!-- ============================================================== -->
            <!-- End PAge Content -->
            <!-- ============================================================== -->
            <!-- ============================================================== -->
            <!-- Right sidebar -->
            <!-- ============================================================== -->
            <!-- .right-sidebar -->
            <div class="right-sidebar">
                <div class="slimscrollright">
                    <div class="rpanel-title"> 主题设置 <span><i class="ti-close right-side-toggle"></i></span>
                    </div>
                    <div class="r-panel-body">
                        <ul id="themecolors" class="m-t-20">
                            <li><b>亮色主题</b></li>
                            <li><a href="javascript:void(0)" data-theme="default" class="default-theme">1</a></li>
                            <li><a href="javascript:void(0)" data-theme="green" class="green-theme">2</a></li>
                            <li><a href="javascript:void(0)" data-theme="red" class="red-theme">3</a></li>
                            <li><a href="javascript:void(0)" data-theme="blue" class="blue-theme working">4</a></li>
                            <li><a href="javascript:void(0)" data-theme="purple" class="purple-theme">5</a></li>
                            <li><a href="javascript:void(0)" data-theme="megna" class="megna-theme">6</a></li>
                            <li class="d-block m-t-30"><b>暗色主题</b></li>
                            <li><a href="javascript:void(0)" data-theme="default-dark" class="default-dark-theme">7</a>
                            </li>
                            <li><a href="javascript:void(0)" data-theme="green-dark" class="green-dark-theme">8</a></li>
                            <li><a href="javascript:void(0)" data-theme="red-dark" class="red-dark-theme">9</a></li>
                            <li><a href="javascript:void(0)" data-theme="blue-dark" class="blue-dark-theme">10</a></li>
                            <li><a href="javascript:void(0)" data-theme="purple-dark" class="purple-dark-theme">11</a>
                            </li>
                            <li><a href="javascript:void(0)" data-theme="megna-dark" class="megna-dark-theme ">12</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- ============================================================== -->
            <!-- End Right sidebar -->
            <!-- ============================================================== -->
        </div>
        <!-- ============================================================== -->
        <!-- End Container fluid  -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- footer -->
        <!-- ============================================================== -->
        <footer class="footer text-dark"> © 武汉大学国家网络安全学院 2018-2028</footer>
        <!-- ============================================================== -->
        <!-- End footer -->
        <!-- ============================================================== -->
    </div>
    <!-- ============================================================== -->
    <!-- End Page wrapper  -->
    <!-- ============================================================== -->
</div>
<!-- ============================================================== -->
<!-- End Wrapper -->
<!-- ============================================================== -->
<!-- ============================================================== -->
<!-- All Jquery -->
<!-- ============================================================== -->
<script src="/static/assets/plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap tether Core JavaScript -->
<script src="/static/assets/plugins/bootstrap/js/popper.min.js"></script>
<script src="/static/assets/plugins/bootstrap/js/bootstrap.min.js"></script>
<!-- slimscrollbar scrollbar JavaScript -->
<script src="/static/js/jquery.slimscroll.js"></script>
<!--Wave Effects -->
<script src="/static/js/waves.js"></script>
<!--Menu sidebar -->
<script src="/static/js/sidebarmenu.js"></script>
<!--stickey kit -->
<script src="/static/assets/plugins/sticky-kit-master/dist/sticky-kit.min.js"></script>
<script src="/static/assets/plugins/sparkline/jquery.sparkline.min.js"></script>
<script src="/static/assets/plugins/sparkline/jquery.sparkline.min.js"></script>
<!--Custom JavaScript -->
<script src="/static/js/custom.min.js"></script>
<!-- ============================================================== -->
<!-- This page plugins -->
<!-- ============================================================== -->
<!-- chartist chart -->
<script src="/static/assets/plugins/chartist-js/dist/chartist.min.js"></script>
<script src="/static/assets/plugins/chartist-plugin-tooltip-master/dist/chartist-plugin-tooltip.min.js"></script>
<!--c3 JavaScript -->
<script src="/static/assets/plugins/d3/d3.min.js"></script>
<script src="/static/assets/plugins/c3-master/c3.min.js"></script>
<!-- Chart JS -->
{#<script src="js/dashboard1.js"></script>#}
<!-- ============================================================== -->
<script src="/static/assets/plugins/footable/js/footable.all.min.js"></script>
<script src="/static/assets/plugins/bootstrap-select/bootstrap-select.min.js" type="text/javascript"></script>
<!--FooTable init-->
<script src="/static/js/footable-init.js"></script>
<!-- ============================================================== -->
<!-- Style switcher -->
<!-- ============================================================== -->
<!-- Style switcher -->

<!-- ============================================================== -->
<script src="/static/assets/plugins/styleswitcher/jQuery.style.switcher.js"></script>
<script src="/static/js/socketio.js"></script>
Chart JS -->
{#<script src="js/dashboard1.js"></script>#}
<!-- ============================================================== -->
<!-- ============================================================== -->
<!-- Style switcher -->
<!-- ============================================================== -->
<!-- Style switcher -->

<!-- ============================================================== -->
{#<script type="text/javascript" charset="utf-8">#}
{#    $(document).ready(function () {#}
{#        const namespace = '/backend'; // change to an empty string to use the global namespace#}
{#        // the socket.io documentation recommends sending an explicit package upon connection#}
{#        // this is specially important when using the global namespace#}
{#        let socket = io.connect('http://' + document.domain + ':' + location.port + namespace);#}
{##}
{#        // socket.on('connect', function(msg) {#}
{#        //   socket.emit('my event', {data: 'I\'m connected!'});#}
{#        //});#}
{##}
{#        socket.on('event', function (msg) {#}
{#            alert(msg)#}
{#        });#}
{##}
{#    });#}
{#</script>#}
<script>
    function agree(e) {
        let id = $(e).attr("id");
        $.ajax({
            type: 'POST',
            contentType: "application/json",
            dataType: 'json',
            url: window.location.search,
            data: JSON.stringify({"serial_number": id, "action": 1}),
            success: function (data) {
                window.location.href = data['next_page'];
            },
        });
        {#alert($(e).attr("id"));#}
    }

    function cancel() {
        let id = $(e).attr("id");
        $.ajax({
            type: 'POST',
            contentType: "application/json",
            dataType: 'json',
            url: window.location.search,
            data: JSON.stringify({"serial_number": id, "action": 0}),
            success: function (data) {
                window.location.href = data['next_page'];
            },
        });
    }


</script>
{% with messages = get_flashed_messages() %}
    {% if messages %}
        <script>
            let messages ={{ messages | safe }};
            for (let i = 0; i < messages.length; i++) {
                $('#overlay').modal('show');
                $('#zcontent').text(messages[i]);
                setTimeout(function () {
                    $('#overlay').modal('hide');
                }, 1200);
            }
        </script>
    {% endif %}
{% endwith %}

<script>
    $('document').ready(function () {
        getRealData(0);
        setInterval(function () {
            getRealData(1)
        }, 10000);//request every x seconds

    });

    function getRealData(first) {
        $.ajax({
            url: "/apis/notice",
            type: "POST",
            data: {
                type: 0,
                first: first
            },
            cache: false,
            success: function (data) {

                appendNotice(data['urls'], data['date']);
            }
        })
    }

    function appendNotice(data, date) {
        for (x in data) {
            let liNode = $.parseHTML('<a href=' + data[x] + '><div class="btn btn-danger btn-circle"><i class="fa fa-link"></i></div><div class="mail-contnet"><h6>通知</h6><span class="mail-desc">新的备案申请</span><span class="time">' + date[x] + '</span></div></a>')
            {#console.log(liNode)#}
            $("#notices").append(liNode)
        }
    }

</script>
</body>
</html>
